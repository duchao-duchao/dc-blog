---
title: Webpack中的hash值有什么作用？
date: 2024-10-15T01:52:22Z
slug: post-14
author: duchao-duchao：https://github.com/duchao-duchao
tags: []
---

`contenthash`、`chunkhash` 和 `hash` 都是 Webpack 中用于生成文件哈希值的方法，但它们的使用场景和生成逻辑有所不同。理解这些差异有助于我们在项目中更好地管理资源缓存。下面是它们的区别和最佳实践：

### 1. **`hash`**
- **定义**: `hash` 是基于整个项目构建过程生成的哈希值。它代表了这次构建的唯一标识，所有文件在同一次构建中会共享相同的 `hash` 值。
- **特点**:
  - **变更范围广**: 任何一个文件的变更都会导致 `hash` 改变，这意味着所有打包的文件（无论内容是否改变）都会更新 `hash` 值。
  - **用途**: 通常用于开发环境，因为在开发阶段频繁修改文件，不需要针对不同文件进行细粒度的缓存控制。
- **限制**:
  - 在生产环境下，不适合用作缓存优化，因为一个文件的变更会导致所有文件的哈希值改变，浏览器无法有效利用缓存。

### 2. **`chunkhash`**
- **定义**: `chunkhash` 是基于 Webpack 中的每个 chunk（代码块）生成的哈希值，不同的 chunk 可能会有不同的 `chunkhash`。
- **特点**:
  - **局部变更**: 只有在特定 chunk 中有变更时，该 chunk 的 `chunkhash` 值才会改变。其他 chunk 的 `chunkhash` 不受影响。
  - **用途**: 适合生产环境，尤其是 JavaScript 代码的打包。当项目代码分块（如使用 `splitChunks` 或 `dynamic import`）时，不同模块的代码变化不会互相影响。
- **限制**:
  - 对于 CSS 文件，使用 `chunkhash` 可能会导致问题，因为 Webpack 处理 CSS 的方式可能会将它们与 JS 文件绑定在一起，这会导致 JS 文件的改变影响 CSS 文件的 `chunkhash`。

### 3. **`contenthash`**
- **定义**: `contenthash` 是基于文件内容生成的哈希值，只有当文件内容变化时才会改变。
- **特点**:
  - **精准控制**: 适用于静态资源（如 CSS、图片），即使 JavaScript 文件变化，CSS 文件的 `contenthash` 仍然保持不变。
  - **用途**: 最适合生产环境，特别是用于 CSS 文件和其他静态资源（如图片、字体等）。它确保了只有在文件内容真正变化时才会生成新的哈希值，从而最大化缓存命中率。
- **优势**:
  - 使用 `contenthash` 可以确保仅当内容改变时才生成新的哈希值，实现最有效的缓存利用。

### 项目中不同类型资源的最佳实践

1. **JavaScript 文件**
   - **使用 `chunkhash`**: 
     - 确保 JavaScript 文件的哈希值与代码块的内容挂钩，不同的代码块互相独立，只有变更的代码块的哈希值才会改变。
     - 结合 Webpack 的 `splitChunks` 插件，确保公共模块和业务代码分开打包，从而实现更精细的缓存控制。

2. **CSS 文件**
   - **使用 `contenthash`**:
     - 因为 CSS 通常会有独立的内容更新频率，因此使用 `contenthash` 可以避免 JavaScript 文件的变化影响到 CSS 文件的哈希值。
     - 通过 `MiniCssExtractPlugin` 等插件将 CSS 文件从 JS 中提取出来，使其独立管理，从而使用 `contenthash`。

3. **图片、字体等静态资源**
   - **使用 `contenthash`**:
     - 这些静态资源通常很少更新，使用 `contenthash` 可以确保在文件内容不变时，浏览器缓存能够长期有效。

### 例子配置
```javascript
const path = require('path');
const MiniCssExtractPlugin = require('mini-css-extract-plugin');

module.exports = {
  entry: './src/index.js',
  output: {
    filename: '[name].[chunkhash].js', // JavaScript 文件使用 chunkhash
    path: path.resolve(__dirname, 'dist'),
  },
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          MiniCssExtractPlugin.loader,
          'css-loader'
        ]
      },
      {
        test: /\.(png|jpg|gif|svg|woff|woff2|eot|ttf|otf)$/,
        type: 'asset/resource',
        generator: {
          filename: 'assets/[name].[contenthash][ext]', // 静态资源使用 contenthash
        },
      },
    ],
  },
  plugins: [
    new MiniCssExtractPlugin({
      filename: '[name].[contenthash].css', // CSS 文件使用 contenthash
    }),
  ],
};
```

---
此文自动发布于：<a href="https://github.com/duchao-duchao/dc-blog/issues/14" target="_blank">github issues</a>
